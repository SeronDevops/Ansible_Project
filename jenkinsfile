pipeline {
    agent any

    environment {
        ANSIBLE_SSH_ARGS = '-o StrictHostKeyChecking=no'
    }

    stages {
        stage('Deploy Nginx and HTML') {
            steps {
                script {
                    def deployCmd = "ansible-playbook -i inventory.ini deploy_nginx.yml"
                    
                    withCredentials([sshUserPrivateKey(credentialsId: '1ac30ea4-d3be-4ed4-ab1a-f2526e6e54f6', keyFileVariable: 'SSH_KEY')]) {
                        sh """
                            echo "$SSH_KEY" > id_rsa
                            chmod 600 id_rsa
                            eval \$(ssh-agent -s)
                            ssh-add id_rsa
                            $deployCmd
                        """
                    }
                }
            }
        }
        
        // Other stages if needed
    }
}
